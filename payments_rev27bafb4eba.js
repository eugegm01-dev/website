define(["jquery","client-server","util/promise","factory","app/channel"],function(a,b,c,d,e){"use strict";return function(a){return new c(function(c,f){b.func("paymentm.issue",a,{success:function(a){a=JSON.parse(a),"ok"===a[2]?d("payment/payment-dialog",function(b){var d=b.create({url:a[3]});a[4]&&e.setWindowId(a[4]),d&&d.then(function(b){b?c(a):f&&f()})}):("error"===a[2]&&console.error(a[3]||"unknown payment ajax error"),f())},error:function(){f()}})})}});