define(["jquery","base/view","popup","util/num-end","models/user/active"],function(a,b,c,d,e){"use strict";var f={width:500,height:449};return b.extend({props:{templates:{main:"balance/tmpl/balance-details",balanceDetailsPopupTemplate:"balance/tmpl/balance-detail-popup-content"},vars:{$balanceDetails:null,balanceDetailPopup:null,mailiki:0,bonus:0,$container:null}},public:{init:function(){return this.setBonusBalance(this.options.bonus||0),this.setMailikiBalance(this.options.balance||0),this.showBalanceDetailPopupHandler=this.showBalanceDetailPopup.bind(this),this.options.$container&&this.options.$container.length?this.$container=this.options.$container:this.$el&&this.$el.length&&(this.$container=this.$el),this.$container&&this.render(this.getAdaptedOptions()),this},destroy:function(){return this.$el.length&&(this.$el.remove(),this.$el.find("[data-popup-link]").off("click",this.showBalanceDetailPopupHandler),delete this.showBalanceDetailPopupHandler),this},show:function(){var a=Boolean(Number(sessionStorage.getItem("isUseBonus")));this.$el&&a===Boolean(Number(this.isUseBonus))?this.$el.fadeIn():(this.isUseBonus=a,this.render(this.getAdaptedOptions()),this.$el.fadeIn())},hide:function(){this.$el&&this.$el.fadeOut()},isVisible:function(){return this.$el.is(":visible")},onRender:function(){this.$el.find("[data-popup-link]").on("click",this.showBalanceDetailPopupHandler),this.$container.append(this.$el)}},protected:{setBonusBalance:function(a){this.mailiki=a},setMailikiBalance:function(a){this.bonus=a},getAdaptedOptions:function(){var a=this.options,b=a.locales,c=a.expireBonusMailiki,f=c&&c.number||0,g=c&&c.upto||0,h=a.burnNext,i=864e5,j=Math.floor(((new Date).getTime()-g)/i),k=b.expireText,l=d.getText(f,k.five,k.one,k.two),m=d.getText(j,k.fiveDays,k.oneDays,k.twoDays),n=a.enabledBonusUsers,o=a.isBonusEnabled,p=o&&(0===n.length||n.includes(e.get("email")));return{isBonusEnabled:p,isShowCheckboxInBalanceDetails:Boolean(Number(a.isShowCheckboxInBalanceDetails)),labelText:b.yourBalance,linkText:b.details,bonusHistory:b.bonusHistory,burnText:b.burnText,burnTextBonus1:b.burnTextBonus1,burnTextBonus2:b.burnTextBonus2,burnTextBonus5:b.burnTextBonus5,expireSum:f,burnNext:h,expireText:l+" "+k.through+" "+j+" "+m,accounts:[{title:b.count.main,sum:this.bonus,accIcon:"cash"},{title:b.count.bonus,sum:this.mailiki,accIcon:"percent-round"}]}},showBalanceDetailPopup:function(){var a=this.options,b={rules:a.rulesList.list};this.balanceDetailPopup?this.balanceDetailPopup.show():this.render("balanceDetailsPopupTemplate",b,function(b){this.balanceDetailPopup=c.create({width:f.width,height:f.height,rootCssClass:"b-popup-2020",isCentered:!0,shouldAdjustScroll:!1,header:a.locales.popupLabel,content:b,buttons:[{type:"main",name:"close",text:a.locales.popupClose,callback:this.onBalanceDetailPopupCloseButtonClick.bind(this)}]})}.bind(this))},onBalanceDetailPopupCloseButtonClick:function(){void 0!==this.balanceDetailPopup&&this.balanceDetailPopup.hide()}}})});