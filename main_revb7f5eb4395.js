var __extends=this&&this.__extends||function(){var a=function(b,c){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g};define(["require","exports","ts/utils","ts/utils","ts/view","util/helpers","payment/payment-dialog","payment/payments","jquery"],function(a,b,c,d,e,f,g,h,i){"use strict";var j="payment",k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.shouldIncrementBadges=!1,b.onPaymentOpen=function(){i(window).on(j,b.onPaymentResult)},b.onPaymentClose=function(){var a,c;void 0!==b.paymentActionTimeout&&(clearTimeout(b.paymentActionTimeout),delete b.paymentActionTimeout),null===(c=null===(a=b.options)||void 0===a?void 0:a.onPaymentClose)||void 0===c?void 0:c.call(a)},b.onPaymentResult=function(a,c){var d,e;window.location.hash&&window.location.hash.indexOf("always-success-payment")!==-1&&(c.status="success"),null===(e=null===(d=b.options)||void 0===d?void 0:d.onPaymentResult)||void 0===e?void 0:e.call(d,a,c),b.paymentActionTimeout=setTimeout(function(){i(window).trigger("close-payment-dialog")},7e3),i(window).off(j,b.onPaymentResult)},b}return __extends(b,a),b.prototype.getContent=function(){return this.$content},b.prototype.init=function(){return a.prototype.init.call(this),this.renderCards(this.options),i(document).on(g.BEFORE_OPEN_EVENT,this.onPaymentOpen),i(document).on(g.BEFORE_CLOSE_EVENT,this.onPaymentClose),this},b.prototype.destroy=function(){return a.prototype.destroy.call(this),i(document).off(g.BEFORE_OPEN_EVENT,this.onPaymentOpen),i(document).off(g.BEFORE_CLOSE_EVENT,this.onPaymentClose),this},b.prototype.renderCards=function(a){var b=this;this.render("purchaseCardTemplates",{purchaseCards:a.data},function(c){a.onCreate&&f.isFunction(a.onCreate)&&a.onCreate(c),b.$content=c,c.find("[data-button-action]").on("click",function(c){var d,e=c.currentTarget.dataset.buttonAction,f=null===(d=a.data.filter(function(a){return a.type===e})[0])||void 0===d?void 0:d.paymentData;b.onBuyButtonClick(f)})})},b.prototype.onBuyButtonClick=function(a){var b,c;null===(c=(b=this.options).onBuyBtnClick)||void 0===c?void 0:c.call(b),i(document).trigger("popup.forceHide"),h(a)},b=__decorate([d.meta({autoInit:!0,templates:{purchaseCardTemplates:"purchase-card/tmpl/purchase-card"},css:["purchase-card"]}),c.extend(e)],b)}(e);return k});