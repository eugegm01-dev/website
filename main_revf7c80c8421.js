define(["jquery","counters","base/view","app/history","app/comet","util/helpers","util/promise","util/scroll","util/resize","util/uri","util/project-head-height","payment/payment-dialog","balance/balance","actions/user-actions","models/user/active"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p=4,q=48,r=a(document.body),s={peoples:"peoples",photo:"photo",groups:"groups",games:"games",hashtags:"hashtags",music:"music",video:"video",internet:"internet"},t=c.extend({props:{deferred:{notifications:"layers/head/notifications",messages:"layers/head/messages",discussions:"layers/head/discussions",actions:"layers/head/actions",games:"layers/head/games",user:"layers/head/user",media:"media",autocomplete:"jquery-ui/autocomplete",friendsCollection:"collections/users/friends",musicCollection:"collections/audio/suggest",videoCollection:"collections/video/suggest",appsCollection:"collections/apps/search",appsInstalledCollection:"collections/apps/catalog",hashtagsCollection:"collections/hashtags/suggest"},templates:{menu:"top-menu/tmpl/menu",suggestItem:"top-menu/tmpl/suggests/item",suggestAppItem:"top-menu/tmpl/suggests/apps",hideFadeButtonTemplate:"top-menu/tmpl/inc/hideFadeButton"},elements:{items:".b-head__menu__buttons__item",search:".b-head__menu__search",header:".b-head__menu",searchSectionsList:".b-head__menu__search__sections__items",searchSectionsTitle:".b-head__menu__search__sections__title",searchSectionsItems:".b-head__menu__search__sections__items__item",searchInput:".b-head__menu__search__input",suggestItems:".b-head__menu__suggests__item"},events:{"click .b-head__menu__buttons__item":"onHeadMenuButtonsItemClick","click .b-head__menu__search__sections__title":"onSearchSectionsTitleClick","click .b-head__menu__search__sections__items__item":"onSearchSectionsItemClick","click .b-head__menu__search__button":"onSearchButtonClick","click .b-head__menu__navigate-to-button":"onNavigateToButtonClick","suggest .b-head__menu__search__input":"onSearchInputSuggest","keydown .b-head__menu__search__input":"onSearchInputKeyDown","focus .b-head__menu__search__input":{delegate:!1,method:"onSearchInputFocus"},"input .b-head__menu__search__input":"onSearchInputInput"},cssClasses:{writeMessage:"e-dialogues__single-message-button",counter:"b-head__menu__buttons__item__counter",withCounter:"b-head__menu__buttons__item_with-counter",fade:"b-head__menu__fade"},defaultOptions:{position:"fixed",selectedFromAutoCompleteTimeout:100,apps:{searchSuggestAppsLimit:7,lastAppsMin:0,lastAppsMax:5,bestAppsMin:0,bestAppsMax:7},fadeAnimationDuration:300,fadeHideTimeout:50},clns:{gameClient:{paymentButtonClick:49644086,search:76601816},search:{any:405881,peoples:405882,photo:405884,music:405886,video:405888,games:405890,hashtags:23812618,groups:405892,internet:405893}},vars:{height:null,offsetTop:null,layers:{},counters:{},isSelectedFromAutoComplete:!1,isPaymentOpened:!1,friends:null,music:null,video:null,apps:null,installedApps:null,bestApps:null,hashtags:null,openedLayer:null,$fade:null,fadeHideTimer:null,isOpenLayerNow:!1,isSelectedSearchSectionByUserInput:!1,defaultSearchSectionId:null,isAuthMenuOpened:!1,paymentDialog:null},css:["top-menu"]},public:{init:function(){var b=new j,c=b.param("browse"),d=this.$el.find(".balance");return this.height=this.$el.height(),this.offsetTop=this.$el.offset().top,this.counters=this.options.counters,d.length&&(this.balance=m.createRunTime(f.extend(!0,{},this.options.balance,{onPayButtonClick:this.onPaymentClick.bind(this)}),d)),this.onWindowBlur=this.toggleAuthMenu.bind(this,!1),this.options.isGameClient&&(window.addEventListener("blur",this.onWindowBlur),window.__PH.authForm.on("show",this.onWindowBlur)),this.onPaymentClose=this.onPaymentClose.bind(this),this.onPaymentOpen=this.onPaymentOpen.bind(this),this.onPaymentClose=this.onPaymentClose.bind(this),this.onWindowScrollHandler=this.onWindowScroll.bind(this),h.on(this.onWindowScrollHandler),this.onWindowResizeHandler=this.onWindowResize.bind(this),i.on(this.onWindowResizeHandler),this.onBodyClickHandler=this.onBodyClick.bind(this),a(document.body).on("click",this.onBodyClickHandler),this.onOpenHeadLayerHandler=this.onOpenHeadLayer.bind(this),a(document.body).on("open-head-layer",this.onOpenHeadLayerHandler),this.openTopMenuLayerWithParams=function(a,b,c){this.open(b,c)}.bind(this),a(document).on("top-menu.openLayer",this.openTopMenuLayerWithParams),this.onBannerLoadedHandler=this.onBannerLoaded.bind(this),a(document.body).on("banner.loaded",this.onBannerLoadedHandler),this.onBoosterLoadedHandler=this.onBoosterLoaded.bind(this),a(document.body).on("booster:loaded",this.onBoosterLoadedHandler),a(document).on(l.BEFORE_OPEN_EVENT,this.onPaymentOpen),a(document).on(l.BEFORE_CLOSE_EVENT,this.onPaymentClose),e.pushEvent.on(this.onCometEvent.bind(this)),c&&this.open(this.getMappedType(c)),this.defaultSearchSectionId=this.options.sections&&this.options.sections.selected&&this.options.sections.selected.id,this.options.sections&&this.options.sections.selected&&this.defaultSearchSectionId&&(this.$searchSectionsItems.removeClass("selected"),this.$searchSectionsItems.filter('[data-id="'+this.defaultSearchSectionId+'"]').addClass("selected")),this.checkFixed(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),this.setFadePosition(),setTimeout(function(){this.setFadePosition()}.bind(this),3e3),this.setActionsCounter(),this},destroy:function(){return this.$hideFadeButton&&delete this.$hideFadeButton,this.onWindowScrollHandler&&(h.off(this.onWindowScrollHandler),delete this.onWindowScrollHandler),this.onWindowResizeHandler&&(i.off(this.onWindowResizeHandler),delete this.onWindowResizeHandler),this.onBodyClickHandler&&(a(document.body).off("click",this.onBodyClickHandler),delete this.onBodyClickHandler),this.onOpenHeadLayerHandler&&(a(document.body).off("open-message",this.onOpenHeadLayerHandler),delete this.onOpenHeadLayerHandler),this.onBoosterLoadedHandler&&(a(document.body).off("booster:loaded",this.onBoosterLoadedHandler),delete this.onBoosterLoadedHandler),this.onBannerLoadedHandler&&(a(document.body).off("banner.loaded",this.onBannerLoadedHandler),delete this.onBannerLoadedHandler),this.onWindowBlur&&(window.removeEventListener("blur",this.onWindowBlur),window.__PH.authForm.off("show",this.onWindowBlur),delete this.onWindowBlur),a(document).off(l.BEFORE_OPEN_EVENT,this.onPaymentOpen),delete this.onPaymentOpen,a(document).off("top-menu.openLayer",this.openTopMenuLayerWithParams),delete this.openTopMenuLayerWithParams,a(document).off(l.BEFORE_CLOSE_EVENT,this.onPaymentClose),delete this.onPaymentClose,this.$fade&&(this.$fade.remove(),delete this.$fade),this.balance&&(this.balance.onUnload(),delete this.balance),t.__super__.destroy.call(this)},getItemByType:function(a){return this.$items.filter('[data-id="'+a+'"]')},hasItemOfType:function(a){return this.getItemByType(a).size()>0},open:function(b,c){var d=this.getItemByType(b);return c=c||{},d.size()&&(this.layers[b]||(this.showFadeOverlay(),this.setFadePosition(),this.$items.removeClass("selected"),d.addClass("selected"),this.openedLayer&&this.layers[this.openedLayer]&&this.layers[this.openedLayer].destroy(),this.require(b,function(e){setTimeout(function(){var a=new e(f.extend(!0,{$container:d},this.options,c));a.on("destroy",this.onLayerDestroy.bind(this,b)).on("change-counter",this.onLayerChangeCounter.bind(this,b)),this.layers[b]=a,"messages"!==b&&d.removeClass(this.cssClasses.withCounter);var g={type:b};r.trigger("top-layer-open",g),this.setTopLayerPosition()}.bind(this)),this.options.isGameClient||this.setUrl(b),a(document.body).addClass("popup-opened").trigger({type:"togglePopupEvent",isOpen:!0})}.bind(this))),this.openedLayer=b),this.setFadePosition(),this},searchSubmit:function(){var a=this.getSearchQuery(),c=this.getSearchType();if(!this.isSelectedFromAutoComplete)switch(b.myrb(this.clns.search.any),this.clns.search[c]&&b.myrb(this.clns.search[c]),c){case s.peoples:this.boosterGo(this.getPeoplesSearchUrl(a));break;case s.photo:this.boosterGo(this.getPhotoSearchUrl(a));break;case s.music:window.open(this.getMusicSearchUrl(a));break;case s.video:window.open(this.getVideoSearchUrl(a));break;case s.games:location.href=this.getAppsSearchUrl(a);break;case s.hashtags:this.boosterGo(this.getHashTagSearchUrl(a));break;case s.groups:location.href=this.getGroupsSearchUrl(a);break;case s.internet:window.open(this.getInternetSearchUrl(a))}this.$el.find(".ui-autocomplete").hide()},setUrl:function(a){var b=new j,c=b.param("browse"),e=d.page();this.opening=!0,b.data.query?c?e=e.replace("browse="+c,"browse="+a):e+="&browse="+a:e+="?browse="+a,d.page(e,d.SetHashModes.SUPPRESS_EVENT)}},protected:{toggleHideFadeButton:function(a){var b=this;a?b.$hideFadeButton?b.$hideFadeButton.fadeIn(100):this.render("hideFadeButtonTemplate",function(a){b.$hideFadeButton=a,b.$hideFadeButton.appendTo(b.$fade),b.$hideFadeButton.fadeIn(100)}):b.$hideFadeButton&&b.$hideFadeButton.fadeOut(100)},showFadeOverlay:function(b){this.$fade&&this.$fade.size()||(this.$fade=a("<div></div>").addClass(this.cssClasses.fade).appendTo(this.$el),this.$fade.on("click",this.hideFadeOverlay.bind(this))),this.$fade.fadeIn(this.options.fadeAnimationDuration),b&&!isNaN(b.topPosition)?this.setFadePosition(b.topPosition):this.setFadePosition(""),b&&!isNaN(b.zIndex)?this.setFadeZIndex(b.zIndex):this.setFadeZIndex(""),clearTimeout(this.fadeHideTimer),this.isOpenLayerNow=!0,this.fadeHideTimer=setTimeout(function(){this.isOpenLayerNow=!1}.bind(this),this.options.fadeHideTimeout)},hideFadeOverlay:function(){this.$fade&&(this.$fade.fadeOut(this.options.fadeAnimationDuration),this.$hideFadeButton&&this.toggleHideFadeButton(!1))},setFadePosition:function(a){if(this.$fade&&this.$fade.size()){var b=this.isAuthMenuOpened?0:isNaN(a)?k.getVisibleMenuHeight():a;this.$fade.css("top",b)}},setFadeZIndex:function(a){this.$fade&&this.$fade.size()&&this.$fade.css("z-index",isNaN(a)?"":a)},toggleAuthMenu:function(a){if(window.__PH){var b=window.__PH.authMenu;setTimeout(function(){if(a)this.toggleHideFadeButton(!0),b.show(),this.isAuthMenuOpened=!0,this.showFadeOverlay({topPosition:0,zIndex:1e3});else{this.isAuthMenuOpened&&(this.toggleHideFadeButton(!1),this.hideFadeOverlay());try{b.hide()}catch(a){}this.isAuthMenuOpened=!1}}.bind(this))}},setIsAuthMenuOpened:function(a){this.isAuthMenuOpened=a},isBoosterPage:function(){return!!a(document.body).data("has-booster")},boosterGo:function(a){this.isBoosterPage()?d.page(a):location.href=a},setTopLayerPosition:function(){var b,c,d,e,f=a(".b-head-layer");f.length&&(b=k.getVisibleMenuHeight()+p,f.css("top",b),d=f.hasClass("b-head-layer_placed-right"),d&&(e=f.parent(),c=Math.round(window.innerWidth-(e.offset().left+e.outerWidth())),c=Math.max(q,c),f.css("right",c)))},initSearchAutoComplete:function(){return new g(function(a){this.$searchInput.data("uiAutocomplete")?a():this.require("autocomplete",function(){this.$searchInput.autocomplete({appendTo:this.$search,minLength:3,source:function(a,b){this.suggestFactory(this.getSearchType(),b)}.bind(this),select:this.onSearchAutoCompleteSelect.bind(this)}),this.$searchInput.data("uiAutocomplete")._renderMenu=this.onSearchInputSuggest.bind(this),a()}.bind(this))}.bind(this))},getMappedType:function(a){return"communication"===a&&(a="discussions"),"dialogues"===a&&(a="messages"),a},getSearchType:function(){return this.options.isGameClient?s.games:this.$searchSectionsItems.filter(".selected").data("id")},getSearchQuery:function(){return this.$searchInput.val().trim()},suggestFactory:function(a,b){a&&f.isFunction(b)&&this.getSuggestCollection(a).then(function(c){c.clear().setQuery(this.getSearchQuery()).suggest().then(function(){b(c.toJSON().map(function(b){return this.getSuggestItem(a,b)}.bind(this)).filter(function(a){return a.isPublished!==!1}))}.bind(this))}.bind(this))},getSuggestCollection:function(a){return new g(function(b,c){switch(a){case s.peoples:this.getFriendsCollection().then(function(){b(this.friends)}.bind(this)).catch(c);break;case s.music:this.getMusicCollection().then(function(){b(this.music)}.bind(this)).catch(c);break;case s.video:this.getVideoCollection().then(function(){b(this.video)}.bind(this)).catch(c);break;case s.games:this.getAppsCollection().then(function(){b(this.apps)}.bind(this)).catch(c);break;case s.hashtags:this.getHashtagsCollection().then(function(){b(this.hashtags)}.bind(this)).catch(c)}}.bind(this))},getFriendsCollection:function(){return new g(function(a,b){return this.friends?a(this.friends):void this.require("friendsCollection",function(b){this.friends=new b,a(this.friends)}.bind(this))}.bind(this))},getAppsCollection:function(){return new g(function(a,b){return this.apps?a(this.apps):void this.require("appsCollection",function(b){this.apps=new b,a(this.apps)}.bind(this))}.bind(this))},getInstalledAppsCollection:function(){return new g(function(a,b){this.require("appsInstalledCollection",function(b){this.installedApps=new b({func:"app.installed",ajaxParams:{check_pics:0}}),this.installedApps.setRef("srch_sug"),a(this.installedApps.fetch())}.bind(this))}.bind(this))},getBestAppsCollection:function(){return new g(function(a,b){return this.bestApps?a(this.bestApps):void this.require("appsInstalledCollection",function(b){this.bestApps=new b({func:"app.genre_gender_age",ajaxParams:{check_pics:0}}),this.bestApps.setRef("srch_sug"),a(this.bestApps.fetch())}.bind(this))}.bind(this))},getMusicCollection:function(){return new g(function(a,b){return this.music?a(this.music):void this.require("musicCollection",function(b){this.music=new b,a(this.music)}.bind(this))}.bind(this))},getVideoCollection:function(){return new g(function(a,b){return this.video?a(this.video):void this.require("videoCollection",function(b){this.video=new b,a(this.video)}.bind(this))}.bind(this))},getHashtagsCollection:function(){return new g(function(a,b){return this.hashtags?a(this.hashtags):void this.require("hashtagsCollection",function(b){this.hashtags=new b,a(this.hashtags)}.bind(this))}.bind(this))},getSuggestItem:function(a,b){var c;switch(a){case s.peoples:c=f.extend(b,{value:b.name,url:b.dir});break;case s.music:c=f.extend(b,{value:b.query,url:this.getMusicSearchUrl(b.query)});break;case s.video:c=f.extend(b,{value:b.text,url:this.getVideoSearchUrl(b.text)});break;case s.games:c=f.extend(b,{img:b.pics["120x60"],inst:b.installationsFormatted,value:b.shortName,url:"/apps/"+b.id+"?ref="+b.ref});break;case s.hashtags:c=f.extend(b,{value:b.text,url:this.getVideoSearchUrl(b.text)})}return c},getPeoplesSearchUrl:function(a){return"/my/search_people?&name="+a},getPhotoSearchUrl:function(a){return"/my/photo_search?q="+a+"&st=search&head=1"},getMusicSearchUrl:function(a){return"/music/search/"+a},getVideoSearchUrl:function(a){return"/video/search/?q="+a},getAppsSearchUrl:function(a){return"/apps/search?q="+a+"&st=search&head=1"},getHashTagSearchUrl:function(a){return"/hashtag/"+a.replace(/[#\s]/g,"")},getGroupsSearchUrl:function(a){return"/my/communities-search?q="+a+"&st=search&head=1"},getInternetSearchUrl:function(a){return"//go.mail.ru/search?q="+a+"&st=search&head=1"},checkFixed:function(b){"fixed"===this.options.position&&(a(document.body).is(".head-fixed")||(this.offsetTop=this.$el.offset().top),b>=this.offsetTop?a(document.body).addClass("head-fixed"):a(document.body).removeClass("head-fixed"))},updateCounters:function(b){this.$items.each(function(c,d){var e=a(d),f=e.data("id");!b[f]||f===this.openedLayer&&"messages"!==f||e.addClass(this.cssClasses.withCounter).find("."+this.cssClasses.counter).text(b[f])}.bind(this)),this.counters=b},setActionsCounter:function(){void 0===this.userActions&&(this.userActions=new n,this.userActions.on("fetched",this.onUserActionsFetched.bind(this))),this.userActions.fetchData()},onUserActionsFetched:function(a,b){var c;b=b||{},c=b.unread,this.updateCounters({actions:c})},showInstalledGamesSuggests:function(){g.all([this.getInstalledAppsCollection(),this.getBestAppsCollection(),this.initSearchAutoComplete()]).then(function(a){var b=a[0],c=a[1],d=this.options.apps.searchSuggestAppsLimit-b.length,e=2;d>2&&(e=d);var f=b.slice(0,this.options.apps.lastAppsMax).map(function(a){return this.getSuggestItem(s.games,a._attr)}.bind(this)),g=c.map(function(a){var b=a._attr.id,c=f.some(function(a){return a.id===b});if(!c)return this.getSuggestItem(s.games,a._attr)}.bind(this)).filter(function(a){return void 0!==a}).slice(0,e),h=f.concat(g);this.$searchInput.data("uiAutocomplete")._suggest(h)}.bind(this))},setSelectedSearchSection:function(a,b){this.$searchSectionsItems.removeClass("selected").filter('[data-id="'+a+'"]').addClass("selected"),this.$searchSectionsTitle.text(this.options.locales.search.sections[a]),this.isSelectedSearchSectionByUserInput=!!b},onLayerDestroy:function(b,c,e){var f=d.page().replace(new RegExp("[?&]browse="+b+"(&email=.+)?","g"),"");a(document.body).removeClass("popup-opened").trigger({type:"togglePopupEvent",isOpen:!1}),this.getItemByType(b).removeClass("selected"),d.page(f,d.SetHashModes.SUPPRESS_EVENT),delete this.layers[b],this.openedLayer=null,r.trigger("top-layer-destroy",{type:b}),this.isOpenLayerNow||this.hideFadeOverlay()},onLayerChangeCounter:function(a,b,c){var d,e=this.getItemByType(a),f=e.find("."+this.cssClasses.counter);this.counters[a]="all"===c?0:this.counters[a]-c,d=this.counters[a],isNaN(d)&&(d=0),f.text(d),d<=0&&e.removeClass(this.cssClasses.withCounter)},onCometEvent:function(a,b){var c;a&&!b&&(b=a),c=b.data,"notification-numbers"===b.name&&this.updateCounters(f.extend(c,{messages:c.dialogues,discussions:c.communication})),"dialogues"===b.type&&c.recipient_email===o.get("email")&&(this.layers.messages&&this.layers.messages.content&&this.layers.messages.content.model?this.layers.messages.content.model.get("email")!==c.author_email&&this.updateCounters({messages:c.total_unread}):this.updateCounters({messages:c.total_unread}))},onWindowScroll:function(a,b){this.checkFixed(b.scrollTop),this.setFadePosition()},onWindowResize:function(){this.setTopLayerPosition()},onBodyClick:function(b){var c,d,e=a(b.target);b.target!==this.$searchSectionsTitle.get(0)&&this.$searchSectionsList.removeClass("show"),e.closest("."+this.cssClasses.writeMessage).size()?c=e.closest("."+this.cssClasses.writeMessage):e.is("."+this.cssClasses.writeMessage)&&(c=e),c&&c.length&&(b.preventDefault(),d=c.data(),this.require("media",function(a){a.closeLayers(),this.open("messages",{messages:{from:d.from,userEmail:d.email}})}.bind(this)))},onOpenHeadLayer:function(a,b){var c=b.type,d={},e={};return c=this.getMappedType(c),d[c]=b.options,e=f.extend(!0,e,b.callbacks),"friendship"!==c&&this.hasItemOfType(c)?("friendship"!==c&&this.open(c,d),void(e&&"function"==typeof e.success&&e.success())):void(e&&"function"==typeof e.fail&&e.fail())},onBoosterLoaded:function(a,b){var c={"/my/photo":s.photo,"/my/communities":s.groups,"/hashtag":s.hashtags,"/my/vip":s.games,"/apps":s.games,"/actions":s.games,"/hi-lo":s.games},d="/"===location.pathname?s.games:s.peoples;Object.keys(c).forEach(function(a){0===location.pathname.indexOf(a)&&(d=c[a])}.bind(this)),this.setSelectedSearchSection(d),this.defaultSearchSectionId=d},onHeadMenuButtonsItemClick:function(c,d){var e=a(d.target).closest(".b-head-layer").size()>0,f=c.data("id");f&&f===this.openedLayer||("user"===f&&window.__PHS&&window.__PHS.isWhiteline&&window.__PH&&window.__PH.activeUser()&&!this.options.isGameClient?this.toggleAuthMenu(!0):(this.open(f),e||b.myrb(c.data("menuButtonCounter"))))},onSearchSectionsTitleClick:function(a,b){this.$searchSectionsList.toggleClass("show")},onSearchSectionsItemClick:function(a,b){this.$searchSectionsTitle.text(a.text()),this.$searchSectionsItems.removeClass("selected"),a.addClass("selected"),this.$searchInput.focus()},onSearchButtonClick:function(a,b){this.searchSubmit()},onNavigateToButtonClick:function(){var a=["/apps"];a.forEach(function(a){0===window.location.pathname.indexOf(a)&&(window.location=a+"?ref=topmenu")})},onPaymentClick:function(){r.hasClass("m-pw-checkout-enabled-balance")?a(window).trigger(l.OPEN_DIALOG,{url:l.DEFAULT_URL}):this.isPaymentOpened||(l.create(),b.myrb(this.clns.gameClient.paymentButtonClick)),b.myrb(this.clns.gameClient.paymentButtonClick)},onPaymentOpen:function(){this.isPaymentOpened=!0},onPaymentClose:function(a,b){this.isPaymentOpened=!1,b&&b.isPaymentDialogDebugEnabled&&console.log("[payment dialog] onPaymentClose (top-menu)","reloadPageAfterClosePopup: ",b.reloadPageAfterClosePopup)},onSearchInputSuggest:function(c,d){this.options.isGameClient&&b.myrb(this.clns.gameClient.search),t.renderList({template:this.getSearchType()===s.games?"suggestAppItem":"suggestItem",data:d,$container:c,isNoCreateViews:!0}).then(function(){this.updateElements(),this.$suggestItems.each(function(b){a(this).data("ui-autocomplete-item",d[b])})}.bind(this))},onSearchAutoCompleteSelect:function(a,b){switch(this.isSelectedFromAutoComplete=!0,clearTimeout(this.selectedFromAutoCompleteTimer),this.selectedFromAutoCompleteTimer=setTimeout(function(){this.isSelectedFromAutoComplete=!1}.bind(this),this.options.selectedFromAutoCompleteTimeout),this.getSearchType()){case s.peoples:this.boosterGo(b.item.dir);break;case s.music:window.open(this.getMusicSearchUrl(b.item.query));break;case s.video:window.open(this.getVideoSearchUrl(b.item.text));break;case s.games:location.href=b.item.url;break;case s.hashtags:this.boosterGo(this.getHashTagSearchUrl(b.item.text))}},onSearchInputKeyDown:function(a,b){13===b.keyCode&&this.searchSubmit()},onSearchInputFocus:function(a,b){this.getSearchType()===s.games&&0===this.getSearchQuery().length?this.showInstalledGamesSuggests():this.initSearchAutoComplete()},onSearchInputInput:function(a,b){var c=this.getSearchQuery();0===c.indexOf("#")&&this.getSearchType()!==s.hashtags?this.setSelectedSearchSection(s.hashtags,!0):0===c.length&&this.getSearchType()===s.hashtags&&this.isSelectedSearchSectionByUserInput&&this.setSelectedSearchSection(this.defaultSearchSectionId)},onBannerLoaded:function(a,b){this.offsetTop=this.$el.offset().top,this.setFadePosition()}}});return t});