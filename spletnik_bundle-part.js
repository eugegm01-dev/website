"use strict";function _typeof(a){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}!function(){function a(){function b(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}),a[b]}function c(a,b,c,d){var f=b&&b.prototype instanceof e?b:e,g=Object.create(f.prototype),h=new n(d||[]);return t(g,"_invoke",{value:j(a,c,h)}),g}function d(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}function e(){}function f(){}function g(){}function h(a){["next","throw","return"].forEach(function(c){b(a,c,function(a){return this._invoke(c,a)})})}function i(a,b){function c(e,f,g,h){var i=d(a[e],a,f);if("throw"!==i.type){var j=i.arg,k=j.value;return k&&"object"==_typeof(k)&&s.call(k,"__await")?b.resolve(k.__await).then(function(a){c("next",a,g,h)},function(a){c("throw",a,g,h)}):b.resolve(k).then(function(a){j.value=a,g(j)},function(a){return c("throw",a,g,h)})}h(i.arg)}var e;t(this,"_invoke",{value:function(a,d){function f(){return new b(function(b,e){c(a,d,b,e)})}return e=e?e.then(f,f):f()}})}function j(a,b,c){var e=y;return function(f,g){if(e===A)throw Error("Generator is already running");if(e===B){if("throw"===f)throw g;return{value:p,done:!0}}for(c.method=f,c.arg=g;;){var h=c.delegate;if(h){var i=k(h,c);if(i){if(i===C)continue;return i}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(e===y)throw e=B,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);e=A;var j=d(a,b,c);if("normal"===j.type){if(e=c.done?B:z,j.arg===C)continue;return{value:j.arg,done:c.done}}"throw"===j.type&&(e=B,c.method="throw",c.arg=j.arg)}}}function k(a,b){var c=b.method,e=a.iterator[c];if(e===p)return b.delegate=null,"throw"===c&&a.iterator.return&&(b.method="return",b.arg=p,k(a,b),"throw"===b.method)||"return"!==c&&(b.method="throw",b.arg=new TypeError("The iterator does not provide a '"+c+"' method")),C;var f=d(e,a.iterator,b.arg);if("throw"===f.type)return b.method="throw",b.arg=f.arg,b.delegate=null,C;var g=f.arg;return g?g.done?(b[a.resultName]=g.value,b.next=a.nextLoc,"return"!==b.method&&(b.method="next",b.arg=p),b.delegate=null,C):g:(b.method="throw",b.arg=new TypeError("iterator result is not an object"),b.delegate=null,C)}function l(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function m(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function n(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(l,this),this.reset(!0)}function o(a){if(a||""===a){var b=a[v];if(b)return b.call(a);if("function"==typeof a.next)return a;if(!isNaN(a.length)){var c=-1,d=function b(){for(;++c<a.length;)if(s.call(a,c))return b.value=a[c],b.done=!1,b;return b.value=p,b.done=!0,b};return d.next=d}}throw new TypeError(_typeof(a)+" is not iterable")}a=function(){return q};var p,q={},r=Object.prototype,s=r.hasOwnProperty,t=Object.defineProperty||function(a,b,c){a[b]=c.value},u="function"==typeof Symbol?Symbol:{},v=u.iterator||"@@iterator",w=u.asyncIterator||"@@asyncIterator",x=u.toStringTag||"@@toStringTag";try{b({},"")}catch(a){b=function(a,b,c){return a[b]=c}}q.wrap=c;var y="suspendedStart",z="suspendedYield",A="executing",B="completed",C={},D={};b(D,v,function(){return this});var E=Object.getPrototypeOf,F=E&&E(E(o([])));F&&F!==r&&s.call(F,v)&&(D=F);var G=g.prototype=e.prototype=Object.create(D);return f.prototype=g,t(G,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:f,configurable:!0}),f.displayName=b(g,x,"GeneratorFunction"),q.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===f||"GeneratorFunction"===(b.displayName||b.name))},q.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,g):(a.__proto__=g,b(a,x,"GeneratorFunction")),a.prototype=Object.create(G),a},q.awrap=function(a){return{__await:a}},h(i.prototype),b(i.prototype,w,function(){return this}),q.AsyncIterator=i,q.async=function(a,b,d,e,f){void 0===f&&(f=Promise);var g=new i(c(a,b,d,e),f);return q.isGeneratorFunction(b)?g:g.next().then(function(a){return a.done?a.value:g.next()})},h(G),b(G,x,"Generator"),b(G,v,function(){return this}),b(G,"toString",function(){return"[object Generator]"}),q.keys=function(a){var b=Object(a),c=[];for(var d in b)c.push(d);return c.reverse(),function a(){for(;c.length;){var d=c.pop();if(d in b)return a.value=d,a.done=!1,a}return a.done=!0,a}},q.values=o,n.prototype={constructor:n,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(m),!a)for(var b in this)"t"===b.charAt(0)&&s.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=p)},stop:function(){this.done=!0;var a=this.tryEntries[0].completion;if("throw"===a.type)throw a.arg;return this.rval},dispatchException:function(a){function b(b,d){return f.type="throw",f.arg=a,c.next=b,d&&(c.method="next",c.arg=p),!!d}if(this.done)throw a;for(var c=this,d=this.tryEntries.length-1;d>=0;--d){var e=this.tryEntries[d],f=e.completion;if("root"===e.tryLoc)return b("end");if(e.tryLoc<=this.prev){var g=s.call(e,"catchLoc"),h=s.call(e,"finallyLoc");if(g&&h){if(this.prev<e.catchLoc)return b(e.catchLoc,!0);if(this.prev<e.finallyLoc)return b(e.finallyLoc)}else if(g){if(this.prev<e.catchLoc)return b(e.catchLoc,!0)}else{if(!h)throw Error("try statement without catch or finally");if(this.prev<e.finallyLoc)return b(e.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&s.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var e=d;break}}e&&("break"===a||"continue"===a)&&e.tryLoc<=b&&b<=e.finallyLoc&&(e=null);var f=e?e.completion:{};return f.type=a,f.arg=b,e?(this.method="next",this.next=e.finallyLoc,C):this.complete(f)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),C},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),m(c),C}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;m(c)}return e}}throw Error("illegal catch attempt")},delegateYield:function(a,b,c){return this.delegate={iterator:o(a),resultName:b,nextLoc:c},"next"===this.method&&(this.arg=p),C}},q}function b(a,b){if("object"!=_typeof(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=_typeof(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}function c(a){var c=b(a,"string");return"symbol"==_typeof(c)?c:c+""}function d(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function e(a){return function(){var b=this,c=arguments;return new Promise(function(e,f){function g(a){d(i,e,f,g,h,"next",a)}function h(a){d(i,e,f,g,h,"throw",a)}var i=a.apply(b,c);g(void 0)})}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,c(e.key),e)}}function h(a,b,c){return b&&g(a.prototype,b),c&&g(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function i(a,b,d){return b=c(b),b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d,a}var j=function(a){return a.TIME_TRAKER="timetracker",a}(j||{}),k=function(a){var b=new URL(window.location.href);return"1"===b.searchParams.get(a)},l=function(a){return"spletnik.debug_".concat(a)},m=function(){try{return"undefined"!=typeof window}catch(a){return!1}},n=function(a){return m()&&k(l(a))?function(b,c){return console.log("[spletnik.".concat(a,"]: ").concat(b),null!==c&&void 0!==c?c:"")}:function(){return null}},o=1e4,p=1,q=1e3,r=n(j.TIME_TRAKER),s=function(){function b(a){f(this,b),i(this,"url",""),i(this,"xemail",""),i(this,"mna",0),i(this,"mnb",0),i(this,"retryTimeout",o),i(this,"maxFailedAttempts",p),i(this,"timeout",-1),i(this,"failedAttempts",0),i(this,"hasDelayedRequest",!1),r("constructor options:",a);var c=window;a.enabled&&!c[b.name]&&(this.url=a.url,this.xemail=a.xemail,this.mna=a.mna,this.mnb=a.mnb,this.retryTimeout=a.retryTimeout,this.maxFailedAttempts=a.maxFailedAttempts,c[b.name]=!0,this.listenTabActivity(),this.listenForNavigation(),void this.send())}return h(b,[{key:"listenTabActivity",value:function(){var a=this;document.addEventListener("visibilitychange",function(){a.hasDelayedRequest&&(r("delayed request was sent after the tab became active"),void a.send())})}},{key:"listenForNavigation",value:function(){var a=this,b=window.location.href,c=new MutationObserver(function(){window.location.href!==b&&(r("location has changed, sending the request now"),window.clearTimeout(a.timeout),void a.send(),b=window.location.href)});c.observe(document,{subtree:!0,childList:!0})}},{key:"send",value:function(){function b(){return c.apply(this,arguments)}var c=e(a().mark(function b(){var c,d,e;return a().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!document.hidden){a.next=4;break}return r("request was delayed since the tab is inactive"),this.hasDelayedRequest=!0,a.abrupt("return");case 4:return a.prev=4,c=this.xemail?new URLSearchParams({xemail:this.xemail,mna:this.mna.toString(),mnb:this.mnb.toString()}):"",r("sending request:",c.toString()),a.next=9,fetch(this.url+(c?"?".concat(c.toString()):""));case 9:return d=a.sent,a.next=12,d.json();case 12:e=a.sent,this.hasDelayedRequest=!1,this.failedAttempts=0,r("response json:",e),e.recallAfter>0?(r("next request is scheduled in (ms):",e.recallAfter),this.scheduleARequest(e.recallAfter*q)):r("next request is not scheduled (server)"),a.next=26;break;case 19:a.prev=19,a.t0=a.catch(4),this.hasDelayedRequest=!1,this.failedAttempts+=1,this.failedAttempts<this.maxFailedAttempts?(r("the request is scheduled to retry in (ms):",this.retryTimeout),this.scheduleARequest(this.retryTimeout)):r("next request is not scheduled (reached maxFailedAttempts)"),r("failed with:",a.t0),console.error("TimeTracker stat was not sent: ".concat(a.t0.toString()));case 26:case"end":return a.stop()}},b,this,[[4,19]])}));return b}()},{key:"scheduleARequest",value:function(a){this.timeout=window.setTimeout(this.send.bind(this),a)}}])}(),t="main",u=i({},j.TIME_TRAKER,s),v="data-spletnik-config",w="data-inited",x="[".concat(v,"]:not([").concat(w,"])"),y=n(t),z=function(a){try{var b=JSON.parse(a.innerHTML);return y("handler config found:",b),b}catch(a){return console.error("Error while parsing spletnik config: ".concat(a.toString())),null}};try{if(m()){var A=document.querySelectorAll(x);A.forEach(function(a){var b=z(a),c=b&&u[b.type];c&&(y("handler found for config:",c.name),new c(b.params),a.setAttribute(w,""))})}}catch(a){console.error("Error while spletnik initialization: ".concat(a.toString()))}}();